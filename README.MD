# üè¢ Sistema de Gest√£o de Empresas

API REST para consulta e gest√£o simplificada de empresas, desenvolvida com Node.js, TypeScript, Express, PostgreSQL e Prisma ORM, seguindo os princ√≠pios da Arquitetura Hexagonal.

[![Node.js](https://img.shields.io/badge/Node.js-22.x-green.svg)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.8-blue.svg)](https://www.typescriptlang.org/)
[![Express](https://img.shields.io/badge/Express-5.1-lightgrey.svg)](https://expressjs.com/)
[![Prisma](https://img.shields.io/badge/Prisma-6.17-2D3748.svg)](https://www.prisma.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-336791.svg)](https://www.postgresql.org/)

---

## üìã √çndice

- [Tecnologias](#-tecnologias)
- [Arquitetura](#-arquitetura)
- [Pr√©-requisitos](#-pr√©-requisitos)
- [Instala√ß√£o](#-instala√ß√£o)
- [Execu√ß√£o](#-execu√ß√£o)
- [Testes](#-testes)
- [Endpoints](#-endpoints)
- [Documenta√ß√£o Swagger](#-documenta√ß√£o-swagger)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [Decis√µes T√©cnicas](#-decis√µes-t√©cnicas)
- [Scripts Dispon√≠veis](#-scripts-dispon√≠veis)

---

## üöÄ Tecnologias

### Backend
- **Node.js** v22+ - Runtime JavaScript
- **TypeScript** v5.8 - Superset JavaScript com tipagem est√°tica
- **Express** v5.1 - Framework web minimalista
- **Zod** v4.1 - Valida√ß√£o de schemas com infer√™ncia de tipos

### Banco de Dados
- **PostgreSQL** v16 - Banco de dados relacional
- **Prisma ORM** v6.17 - ORM moderno com type-safety

### Testes
- **Vitest** v3.2.4 - Framework de testes unit√°rios e integra√ß√£o
- **Supertest** v7.1.4 - Testes HTTP end-to-end

### Documenta√ß√£o
- **Swagger UI Express** v5.0.1 - Interface interativa de documenta√ß√£o OpenAPI 3.0

### DevOps
- **Docker** & **Docker Compose** - Containeriza√ß√£o
- **ESLint** & **Prettier** - Qualidade e formata√ß√£o de c√≥digo
- **Husky** - Git hooks para qualidade

---

## üèóÔ∏è Arquitetura

O projeto segue os princ√≠pios da **Arquitetura Hexagonal (Ports & Adapters)**, com separa√ß√£o clara em 3 camadas:

```
src/
‚îú‚îÄ‚îÄ core/                # N√∫cleo da aplica√ß√£o (Domain + Application)
‚îÇ   ‚îú‚îÄ‚îÄ entities/        # Entidades de dom√≠nio puras
‚îÇ   ‚îú‚îÄ‚îÄ ports/           # Interfaces/contratos (IRepository)
‚îÇ   ‚îú‚îÄ‚îÄ services/        # L√≥gica de neg√≥cio (use cases)
‚îÇ   ‚îî‚îÄ‚îÄ errors/          # Erros customizados
‚îÇ
‚îú‚îÄ‚îÄ adapters/            # Adaptadores externos
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # HTTP handlers
‚îÇ   ‚îú‚îÄ‚îÄ repositories/    # Implementa√ß√£o Prisma
‚îÇ   ‚îú‚îÄ‚îÄ database/        # Configura√ß√£o Prisma
‚îÇ   ‚îú‚îÄ‚îÄ validators/      # Schemas Zod
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Defini√ß√£o de rotas
‚îÇ   ‚îî‚îÄ‚îÄ middlewares/     # Middlewares Express
‚îÇ
‚îú‚îÄ‚îÄ config/              # Configura√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ swagger.ts       # Documenta√ß√£o OpenAPI
‚îÇ
‚îî‚îÄ‚îÄ server.ts            # Ponto de entrada
```

**Benef√≠cios:**
- ‚úÖ Separa√ß√£o clara de responsabilidades
- ‚úÖ Independ√™ncia de frameworks externos
- ‚úÖ Facilita testes unit√°rios e de integra√ß√£o
- ‚úÖ C√≥digo limpo e manuten√≠vel
- ‚úÖ Escal√°vel para novos m√≥dulos

---

## üì¶ Pr√©-requisitos

Antes de come√ßar, certifique-se de ter instalado:

- **Node.js** 22.x ou superior ([Download](https://nodejs.org/))
- **pnpm** 10.x ou superior ([Instala√ß√£o](https://pnpm.io/installation))
- **PostgreSQL** 16.x ou superior ([Download](https://www.postgresql.org/download/))
- **Docker** (opcional, mas recomendado) ([Download](https://www.docker.com/))

---

## üîß Instala√ß√£o

### 1. Clone o reposit√≥rio

```bash
git clone https://github.com/ENDERSON-MARIN/COMPANY-MANAGEMENT
cd company-management-api
```

### 2. Instale as depend√™ncias

```bash
pnpm install
```

### 3. Configure as vari√°veis de ambiente

```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas configura√ß√µes:

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/company_db?schema=public"
PORT=3000
NODE_ENV=development
```

### 4. Configure o banco de dados

#### Op√ß√£o A: Com Docker (Recomendado)

```bash
# Subir banco PostgreSQL
docker-compose up -d postgres

# Aguardar banco inicializar (~10 segundos)
sleep 10

# Gerar cliente Prisma
pnpm prisma:generate

# Executar migra√ß√µes
pnpm prisma:migrate
```

#### Op√ß√£o B: PostgreSQL local

```bash
# Criar banco de dados
createdb company_db

# Gerar cliente Prisma
pnpm prisma:generate

# Executar migra√ß√µes
pnpm prisma:migrate
```

---

## üöÄ Execu√ß√£o

### Desenvolvimento

```bash
# Iniciar em modo watch (recarrega automaticamente)
pnpm dev
```

A API estar√° dispon√≠vel em: **http://localhost:3000**

### Produ√ß√£o

```bash
# Compilar TypeScript
pnpm build

# Iniciar servidor
pnpm start
```

### Docker (Aplica√ß√£o Completa)

```bash
# Subir todos os servi√ßos (PostgreSQL + API)
docker-compose up -d

# Ver logs
docker-compose logs -f api

# Parar servi√ßos
docker-compose down

# Remover volumes (limpar dados)
docker-compose down -v
```

---

## üß™ Testes

O projeto possui cobertura completa de testes:

### Executar todos os testes

```bash
pnpm test
```

### Executar com cobertura

```bash
pnpm test:coverage
```

**Cobertura esperada:** > 90% em todas as m√©tricas

### Testes espec√≠ficos

```bash
# Apenas testes unit√°rios
pnpm test tests/unit

# Apenas testes de integra√ß√£o
pnpm test tests/integration

# Apenas testes E2E
pnpm test tests/e2e

# Teste espec√≠fico
pnpm test tests/unit/core/entities/Company.spec.ts

# Modo watch
pnpm test --watch
```

### Configurar banco de teste

```bash
# Criar banco de testes
createdb company_db_test

# Executar migra√ß√µes
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/company_db_test?schema=public" pnpm prisma:migrate
```

### Tipos de testes implementados

| Tipo | Quantidade | Descri√ß√£o |
|------|-----------|-----------|
| **Unit√°rios** | ~50 | Entidades, Services, Validators, Errors |
| **Integra√ß√£o** | ~15 | Reposit√≥rios com banco real |
| **E2E** | ~30 | API completa com Supertest |
| **Total** | ~95 | Cobertura > 90% |

---

## üì° Endpoints

### Base URL
```
http://localhost:3000/api
```

---

### 1. **POST** `/api/companies`
Cria uma nova empresa no sistema.

**Request Body:**
```json
{
  "name": "Tech Solutions LTDA",
  "cnpj": "12345678901234",
  "email": "contato@techsolutions.com",
  "phone": "47999999999",
  "address": "Rua das Flores, 123",
}
```

**Campos obrigat√≥rios:** `name`, `cnpj`, `email`

**Valida√ß√µes:**
- `name`: 3-255 caracteres
- `cnpj`: 14 d√≠gitos num√©ricos (sem formata√ß√£o)
- `email`: formato de email v√°lido
- `phone`: 10-11 d√≠gitos (opcional)

**Respostas:**
- `201 Created`: Empresa criada com sucesso
- `400 Bad Request`: Dados inv√°lidos
- `409 Conflict`: CNPJ j√° cadastrado

**Exemplo de resposta:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Tech Solutions LTDA",
  "cnpj": "12345678901234",
  "email": "contato@techsolutions.com",
  "phone": "47999999999",
  "address": "Rua das Flores, 123",
  "createdAt": "2025-10-22T10:30:00.000Z",
  "updatedAt": "2025-10-22T10:30:00.000Z"
}
```

---

### 2. **GET** `/api/companies`
Retorna a lista de todas as empresas cadastradas, ordenadas por data de cria√ß√£o (mais recentes primeiro).

**Respostas:**
- `200 OK`: Lista de empresas retornada com sucesso

**Exemplo de resposta:**
```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Tech Solutions LTDA",
    "cnpj": "12345678901234",
    "email": "contato@techsolutions.com",
    "createdAt": "2025-10-22T10:30:00.000Z",
    "updatedAt": "2025-10-22T10:30:00.000Z"
  },
  {
    "id": "650e8400-e29b-41d4-a716-446655440001",
    "name": "Inova√ß√£o Digital SA",
    "cnpj": "98765432109876",
    "email": "contato@inovacao.com",
    "createdAt": "2025-10-21T15:20:00.000Z",
    "updatedAt": "2025-10-21T15:20:00.000Z"
  }
]
```

---

### 3. **GET** `/api/companies/{id}`
Retorna os dados de uma empresa espec√≠fica pelo seu ID.

**Par√¢metros:**
- `id` (UUID): Identificador √∫nico da empresa

**Respostas:**
- `200 OK`: Empresa encontrada
- `400 Bad Request`: ID inv√°lido (n√£o √© UUID)
- `404 Not Found`: Empresa n√£o encontrada

**Exemplo de resposta:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Tech Solutions LTDA",
  "cnpj": "12345678901234",
  "email": "contato@techsolutions.com",
  "phone": "47999999999",
  "address": "Rua das Flores, 123",
  "createdAt": "2025-10-22T10:30:00.000Z",
  "updatedAt": "2025-10-22T10:30:00.000Z"
}
```

---

### 4. **PUT** `/api/companies/{id}`
Atualiza os dados de uma empresa existente. Todos os campos s√£o opcionais.

**Par√¢metros:**
- `id` (UUID): Identificador √∫nico da empresa

**Request Body (campos opcionais):**
```json
{
  "name": "Tech Solutions SA",
  "email": "novo@techsolutions.com",
  "phone": "47888888888"
}
```

**Respostas:**
- `200 OK`: Empresa atualizada com sucesso
- `400 Bad Request`: Dados inv√°lidos
- `404 Not Found`: Empresa n√£o encontrada
- `409 Conflict`: CNPJ j√° est√° em uso por outra empresa

**Exemplo de resposta:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Tech Solutions SA",
  "cnpj": "12345678901234",
  "email": "novo@techsolutions.com",
  "phone": "47888888888",
  "address": "Rua das Flores, 123",
  "createdAt": "2025-10-22T10:30:00.000Z",
  "updatedAt": "2025-10-22T11:45:00.000Z"
}
```

---

### 5. **DELETE** `/api/companies/{id}`
Remove uma empresa do sistema permanentemente.

**Par√¢metros:**
- `id` (UUID): Identificador √∫nico da empresa

**Respostas:**
- `204 No Content`: Empresa deletada com sucesso (sem corpo de resposta)
- `400 Bad Request`: ID inv√°lido
- `404 Not Found`: Empresa n√£o encontrada

---

## üìö Documenta√ß√£o Swagger

A API possui documenta√ß√£o interativa completa com Swagger UI.

### Acessar documenta√ß√£o
```
http://localhost:3000/api-docs
```

### Recursos dispon√≠veis:
- ‚úÖ Interface interativa "Try it out"
- ‚úÖ Todos os endpoints documentados
- ‚úÖ Schemas de valida√ß√£o detalhados
- ‚úÖ Exemplos de requisi√ß√µes e respostas
- ‚úÖ C√≥digos de erro com descri√ß√µes
- ‚úÖ Exporta√ß√£o para Postman/Insomnia
- ‚úÖ Tema escuro moderno

### Exportar para Postman/Insomnia
```
http://localhost:3000/api-docs.json
```

---

## üóÇÔ∏è Estrutura do Projeto

```
company-management-api/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma              # Schema do banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ migrations/                # Hist√≥rico de migra√ß√µes
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ core/                      # N√∫cleo (Domain + Application)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Company.ts         # Entidade Company
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ports/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ICompanyRepository.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CompanyService.ts  # L√≥gica de neg√≥cio
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ errors/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ AppError.ts
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ adapters/                  # Adaptadores externos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CompanyController.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PrismaCompanyRepository.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prisma.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validators/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ companySchemas.ts
‚îÇ
