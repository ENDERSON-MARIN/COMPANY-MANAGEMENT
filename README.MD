# ğŸ¢ Sistema de GestÃ£o de Empresas

API REST para consulta e gestÃ£o simplificada de empresas, desenvolvida com Node.js, TypeScript, Express, PostgreSQL e Prisma ORM, seguindo os princÃ­pios da Arquitetura Hexagonal.

[![Node.js](https://img.shields.io/badge/Node.js-22.x-green.svg)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.8-blue.svg)](https://www.typescriptlang.org/)
[![Express](https://img.shields.io/badge/Express-5.1-lightgrey.svg)](https://expressjs.com/)
[![Prisma](https://img.shields.io/badge/Prisma-6.17-2D3748.svg)](https://www.prisma.io/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-336791.svg)](https://www.postgresql.org/)

---

## ğŸ“‹ Ãndice

- [Tecnologias](#-tecnologias)
- [Arquitetura](#-arquitetura)
- [PrÃ©-requisitos](#-prÃ©-requisitos)
- [InstalaÃ§Ã£o](#-instalaÃ§Ã£o)
- [ExecuÃ§Ã£o](#-execuÃ§Ã£o)
- [Testes](#-testes)
- [Endpoints](#-endpoints)
- [DocumentaÃ§Ã£o Swagger](#-documentaÃ§Ã£o-swagger)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [DecisÃµes TÃ©cnicas](#-decisÃµes-tÃ©cnicas)
- [Scripts DisponÃ­veis](#-scripts-disponÃ­veis)

---

## ğŸš€ Tecnologias

### Backend
- **Node.js** v22+ - Runtime JavaScript
- **TypeScript** v5.8 - Superset JavaScript com tipagem estÃ¡tica
- **Express** v5.1 - Framework web minimalista
- **Zod** v4.1 - ValidaÃ§Ã£o de schemas com inferÃªncia de tipos

### Banco de Dados
- **PostgreSQL** v16 - Banco de dados relacional
- **Prisma ORM** v6.17 - ORM moderno com type-safety

### Testes
- **Vitest** v3.2.4 - Framework de testes unitÃ¡rios e integraÃ§Ã£o
- **Supertest** v7.1.4 - Testes HTTP end-to-end

### DocumentaÃ§Ã£o
- **Swagger UI Express** v5.0.1 - Interface interativa de documentaÃ§Ã£o OpenAPI 3.0

### DevOps
- **Docker** & **Docker Compose** - ContainerizaÃ§Ã£o
- **ESLint** & **Prettier** - Qualidade e formataÃ§Ã£o de cÃ³digo
- **Husky** - Git hooks para qualidade

---

## ğŸ—ï¸ Arquitetura

O projeto segue os princÃ­pios da **Arquitetura Hexagonal (Ports & Adapters)**, com separaÃ§Ã£o clara em 3 camadas:

```
src/
â”œâ”€â”€ core/                # NÃºcleo da aplicaÃ§Ã£o (Domain + Application)
â”‚   â”œâ”€â”€ entities/        # Entidades de domÃ­nio puras
â”‚   â”œâ”€â”€ ports/           # Interfaces/contratos (IRepository)
â”‚   â”œâ”€â”€ services/        # LÃ³gica de negÃ³cio (use cases)
â”‚   â””â”€â”€ errors/          # Erros customizados
â”‚
â”œâ”€â”€ adapters/            # Adaptadores externos
â”‚   â”œâ”€â”€ controllers/     # HTTP handlers
â”‚   â”œâ”€â”€ repositories/    # ImplementaÃ§Ã£o Prisma
â”‚   â”œâ”€â”€ database/        # ConfiguraÃ§Ã£o Prisma
â”‚   â”œâ”€â”€ validators/      # Schemas Zod
â”‚   â”œâ”€â”€ routes/          # DefiniÃ§Ã£o de rotas
â”‚   â””â”€â”€ middlewares/     # Middlewares Express
â”‚
â”œâ”€â”€ config/              # ConfiguraÃ§Ãµes
â”‚   â””â”€â”€ swagger.ts       # DocumentaÃ§Ã£o OpenAPI
â”‚
â””â”€â”€ server.ts            # Ponto de entrada
```

**BenefÃ­cios:**
- âœ… SeparaÃ§Ã£o clara de responsabilidades
- âœ… IndependÃªncia de frameworks externos
- âœ… Facilita testes unitÃ¡rios e de integraÃ§Ã£o
- âœ… CÃ³digo limpo e manutenÃ­vel
- âœ… EscalÃ¡vel para novos mÃ³dulos

---

## ğŸ“¦ PrÃ©-requisitos

Antes de comeÃ§ar, certifique-se de ter instalado:

- **Node.js** 22.x ou superior ([Download](https://nodejs.org/))
- **pnpm** 10.x ou superior ([InstalaÃ§Ã£o](https://pnpm.io/installation))
- **PostgreSQL** 16.x ou superior ([Download](https://www.postgresql.org/download/))
- **Docker** (opcional, mas recomendado) ([Download](https://www.docker.com/))

---

## ğŸ”§ InstalaÃ§Ã£o

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/ENDERSON-MARIN/COMPANY-MANAGEMENT
cd company-management-api
```

### 2. Instale as dependÃªncias

```bash
pnpm install
```

### 3. Configure as variÃ¡veis de ambiente

```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas configuraÃ§Ãµes:

```env
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/company_db?schema=public"
PORT=3000
NODE_ENV=development
```

### 4. Configure o banco de dados

#### OpÃ§Ã£o A: Com Docker (Recomendado)

```bash
# Subir banco PostgreSQL
docker-compose up -d postgres

# Aguardar banco inicializar (~10 segundos)
sleep 10

# Gerar cliente Prisma
pnpm prisma:generate

# Executar migraÃ§Ãµes
pnpm prisma:migrate
```

#### OpÃ§Ã£o B: PostgreSQL local

```bash
# Criar banco de dados
createdb company_db

# Gerar cliente Prisma
pnpm prisma:generate

# Executar migraÃ§Ãµes
pnpm prisma:migrate
```

---

## ğŸš€ ExecuÃ§Ã£o

### Desenvolvimento

```bash
# Iniciar em modo watch (recarrega automaticamente)
pnpm dev
```

A API estarÃ¡ disponÃ­vel em: **http://localhost:3000**

### ProduÃ§Ã£o

```bash
# Compilar TypeScript
pnpm build

# Iniciar servidor
pnpm start
```

### Docker (AplicaÃ§Ã£o Completa)

```bash
# Subir todos os serviÃ§os (PostgreSQL + API)
docker-compose up -d

# Ver logs
docker-compose logs -f api

# Parar serviÃ§os
docker-compose down

# Remover volumes (limpar dados)
docker-compose down -v
```

---

## ğŸ§ª Testes

O projeto possui cobertura completa de testes:

### Executar todos os testes

```bash
pnpm test
```

### Executar com cobertura

```bash
pnpm test:coverage
```

**Cobertura esperada:** > 90% em todas as mÃ©tricas

### Testes especÃ­ficos

```bash
# Apenas testes unitÃ¡rios
pnpm test tests/unit

# Apenas testes de integraÃ§Ã£o
pnpm test tests/integration

# Apenas testes E2E
pnpm test tests/e2e

# Teste especÃ­fico
pnpm test tests/unit/core/entities/Company.spec.ts

# Modo watch
pnpm test --watch
```

### Configurar banco de teste

```bash
# Criar banco de testes
createdb company_db_test

# Executar migraÃ§Ãµes
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/company_db_test?schema=public" pnpm prisma:migrate
```

### Tipos de testes implementados

| Tipo | Quantidade | DescriÃ§Ã£o |
|------|-----------|-----------|
| **UnitÃ¡rios** | ~50 | Entidades, Services, Validators, Errors |
| **IntegraÃ§Ã£o** | ~15 | RepositÃ³rios com banco real |
| **E2E** | ~30 | API completa com Supertest |
| **Total** | ~95 | Cobertura > 90% |

---

## ğŸ“¡ Endpoints

### Base URL
```
http://localhost:3000/api
```

---

### 1. **POST** `/api/companies`
Cria uma nova empresa no sistema.

**Request Body:**
```json
{
  "name": "Tech Solutions LTDA",
  "cnpj": "12345678901234",
  "email": "contato@techsolutions.com",
  "phone": "47999999999",
  "address": "Rua das Flores, 123",
}
```

**Campos obrigatÃ³rios:** `name`, `cnpj`, `email`

**ValidaÃ§Ãµes:**
- `name`: 3-255 caracteres
- `cnpj`: 14 dÃ­gitos numÃ©ricos (sem formataÃ§Ã£o)
- `email`: formato de email vÃ¡lido
- `phone`: 10-11 dÃ­gitos (opcional)

**Respostas:**
- `201 Created`: Empresa criada com sucesso
- `400 Bad Request`: Dados invÃ¡lidos
- `409 Conflict`: CNPJ jÃ¡ cadastrado

**Exemplo de resposta:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Tech Solutions LTDA",
  "cnpj": "12345678901234",
  "email": "contato@techsolutions.com",
  "phone": "47999999999",
  "address": "Rua das Flores, 123",
  "createdAt": "2025-10-22T10:30:00.000Z",
  "updatedAt": "2025-10-22T10:30:00.000Z"
}
```

---

### 2. **GET** `/api/companies`
Retorna a lista de todas as empresas cadastradas, ordenadas por data de criaÃ§Ã£o (mais recentes primeiro).

**Respostas:**
- `200 OK`: Lista de empresas retornada com sucesso

**Exemplo de resposta:**
```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "Tech Solutions LTDA",
    "cnpj": "12345678901234",
    "email": "contato@techsolutions.com",
    "createdAt": "2025-10-22T10:30:00.000Z",
    "updatedAt": "2025-10-22T10:30:00.000Z"
  },
  {
    "id": "650e8400-e29b-41d4-a716-446655440001",
    "name": "InovaÃ§Ã£o Digital SA",
    "cnpj": "98765432109876",
    "email": "contato@inovacao.com",
    "createdAt": "2025-10-21T15:20:00.000Z",
    "updatedAt": "2025-10-21T15:20:00.000Z"
  }
]
```

---

### 3. **GET** `/api/companies/{id}`
Retorna os dados de uma empresa especÃ­fica pelo seu ID.

**ParÃ¢metros:**
- `id` (UUID): Identificador Ãºnico da empresa

**Respostas:**
- `200 OK`: Empresa encontrada
- `400 Bad Request`: ID invÃ¡lido (nÃ£o Ã© UUID)
- `404 Not Found`: Empresa nÃ£o encontrada

**Exemplo de resposta:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Tech Solutions LTDA",
  "cnpj": "12345678901234",
  "email": "contato@techsolutions.com",
  "phone": "47999999999",
  "address": "Rua das Flores, 123",
  "createdAt": "2025-10-22T10:30:00.000Z",
  "updatedAt": "2025-10-22T10:30:00.000Z"
}
```

---

### 4. **PUT** `/api/companies/{id}`
Atualiza os dados de uma empresa existente. Todos os campos sÃ£o opcionais.

**ParÃ¢metros:**
- `id` (UUID): Identificador Ãºnico da empresa

**Request Body (campos opcionais):**
```json
{
  "name": "Tech Solutions SA",
  "email": "novo@techsolutions.com",
  "phone": "47888888888"
}
```

**Respostas:**
- `200 OK`: Empresa atualizada com sucesso
- `400 Bad Request`: Dados invÃ¡lidos
- `404 Not Found`: Empresa nÃ£o encontrada
- `409 Conflict`: CNPJ jÃ¡ estÃ¡ em uso por outra empresa

**Exemplo de resposta:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Tech Solutions SA",
  "cnpj": "12345678901234",
  "email": "novo@techsolutions.com",
  "phone": "47888888888",
  "address": "Rua das Flores, 123",
  "createdAt": "2025-10-22T10:30:00.000Z",
  "updatedAt": "2025-10-22T11:45:00.000Z"
}
```

---

### 5. **DELETE** `/api/companies/{id}`
Remove uma empresa do sistema permanentemente.

**ParÃ¢metros:**
- `id` (UUID): Identificador Ãºnico da empresa

**Respostas:**
- `204 No Content`: Empresa deletada com sucesso (sem corpo de resposta)
- `400 Bad Request`: ID invÃ¡lido
- `404 Not Found`: Empresa nÃ£o encontrada

---

## ğŸ“š DocumentaÃ§Ã£o Swagger

A API possui documentaÃ§Ã£o interativa completa com Swagger UI.

### Acessar documentaÃ§Ã£o
```
http://localhost:3000/api-docs
```

### Recursos disponÃ­veis:
- âœ… Interface interativa "Try it out"
- âœ… Todos os endpoints documentados
- âœ… Schemas de validaÃ§Ã£o detalhados
- âœ… Exemplos de requisiÃ§Ãµes e respostas
- âœ… CÃ³digos de erro com descriÃ§Ãµes
- âœ… ExportaÃ§Ã£o para Postman/Insomnia
- âœ… Tema escuro moderno

### Exportar para Postman/Insomnia
```
http://localhost:3000/api-docs.json
```

---

## ğŸ—‚ï¸ Estrutura do Projeto

```
company-management-api/
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma              # Schema do banco de dados
â”‚   â””â”€â”€ migrations/                # HistÃ³rico de migraÃ§Ãµes
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/                      # NÃºcleo (Domain + Application)
â”‚   â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”‚   â””â”€â”€ Company.ts         # Entidade Company
â”‚   â”‚   â”œâ”€â”€ ports/
â”‚   â”‚   â”‚   â””â”€â”€ ICompanyRepository.ts
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ CompanyService.ts  # LÃ³gica de negÃ³cio
â”‚   â”‚   â””â”€â”€ errors/
â”‚   â”‚       â””â”€â”€ AppError.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ adapters/                  # Adaptadores externos
â”‚   â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”‚   â””â”€â”€ CompanyController.ts
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â””â”€â”€ PrismaCompanyRepository.ts
â”‚   â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”‚   â””â”€â”€ prisma.ts
â”‚   â”‚   â”œâ”€â”€ validators/
â”‚   â”‚   â”‚   â””â”€â”€ companySchemas.ts
â”‚
